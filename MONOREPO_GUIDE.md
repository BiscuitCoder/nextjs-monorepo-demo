# Monorepo çŸ¥è¯†ç‚¹ä¸å¤„ç†æ–¹å¼å®Œæ•´æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†æ¢³ç†äº†æœ¬é¡¹ç›®ä¸­ä½¿ç”¨çš„æ‰€æœ‰ monorepo çŸ¥è¯†ç‚¹ã€é…ç½®æ–¹å¼å’Œæœ€ä½³å®è·µã€‚

## ğŸ“š ç›®å½•

1. [æ ¸å¿ƒæ¶æ„](#ä¸€æ ¸å¿ƒæ¶æ„)
2. [æœ¬åœ°åŒ…å¼•ç”¨æœºåˆ¶](#äºŒæœ¬åœ°åŒ…å¼•ç”¨æœºåˆ¶)
3. [è„šæœ¬ç®¡ç†ç­–ç•¥](#ä¸‰è„šæœ¬ç®¡ç†ç­–ç•¥)
4. [Next.js é›†æˆé…ç½®](#å››nextjs-é›†æˆé…ç½®)
5. [TypeScript é…ç½®ç­–ç•¥](#äº”typescript-é…ç½®ç­–ç•¥)
6. [åŒ…æ„å»ºé…ç½®](#å…­åŒ…æ„å»ºé…ç½®)
7. [ä¾èµ–ç®¡ç†ç­–ç•¥](#ä¸ƒä¾èµ–ç®¡ç†ç­–ç•¥)
8. [å¼€å‘å·¥ä½œæµ](#å…«å¼€å‘å·¥ä½œæµ)
9. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#ä¹å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
10. [æœ€ä½³å®è·µæ€»ç»“](#åæœ€ä½³å®è·µæ€»ç»“)
11. [å‘½ä»¤é€ŸæŸ¥è¡¨](#åä¸€å‘½ä»¤é€ŸæŸ¥è¡¨)

---

## ä¸€ã€æ ¸å¿ƒæ¶æ„

### 1. é¡¹ç›®ç»“æ„

```
monorepo-project-setup/
â”œâ”€â”€ apps/              # åº”ç”¨å±‚ï¼ˆå¯ç‹¬ç«‹è¿è¡Œçš„åº”ç”¨ï¼‰
â”‚   â”œâ”€â”€ business/      # ä¸šåŠ¡åº”ç”¨ï¼ˆç«¯å£ 3000ï¼‰
â”‚   â””â”€â”€ docs/          # æ–‡æ¡£åº”ç”¨ï¼ˆç«¯å£ 3001ï¼‰
â”œâ”€â”€ packages/           # å…±äº«åŒ…å±‚ï¼ˆå¯å¤ç”¨çš„åº“ï¼‰
â”‚   â”œâ”€â”€ ui/            # UI ç»„ä»¶åº“ (@repo/ui)
â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°åº“ (@repo/utils)
â””â”€â”€ app/               # æ ¹åº”ç”¨ï¼ˆç«¯å£ 3002ï¼‰
```

### 2. åŒ…ç®¡ç†å™¨ï¼šPNPM Workspace

**é…ç½®æ–‡ä»¶ï¼š`pnpm-workspace.yaml`**

```yaml
packages:
  - "apps/*"
  - "packages/*"
```

**ä½œç”¨ï¼š**
- å®šä¹‰ workspace èŒƒå›´ï¼Œå‘Šè¯‰ pnpm å“ªäº›ç›®å½•æ˜¯ workspace åŒ…
- æ”¯æŒ glob æ¨¡å¼åŒ¹é…ï¼ˆ`*` é€šé…ç¬¦ï¼‰
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­åŒ…çš„ä¾èµ–å®‰è£…å’Œé“¾æ¥

**å…³é”®ç‚¹ï¼š**
- åªæœ‰åœ¨æ­¤é…ç½®ä¸­çš„ç›®å½•æ‰ä¼šè¢«è¯†åˆ«ä¸º workspace åŒ…
- æ”¯æŒåµŒå¥—ç›®å½•å’Œé€šé…ç¬¦æ¨¡å¼
- æ ¹ç›®å½•æœ¬èº«ä¸æ˜¯ workspace åŒ…ï¼ˆé™¤éæ˜ç¡®å£°æ˜ï¼‰

---

## äºŒã€æœ¬åœ°åŒ…å¼•ç”¨æœºåˆ¶

### 1. Workspace åè®®

**åœ¨åº”ç”¨çš„ `package.json` ä¸­å¼•ç”¨æœ¬åœ°åŒ…ï¼š**

```json
{
  "dependencies": {
    "@repo/ui": "workspace:*",
    "@repo/utils": "workspace:*"
  }
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… **å¿…é¡»ä½¿ç”¨ `workspace:*`**ï¼Œä¸èƒ½ä½¿ç”¨ `latest` æˆ–å…·ä½“ç‰ˆæœ¬å·
- `workspace:*` è¡¨ç¤ºä½¿ç”¨æœ¬åœ° workspace ä¸­çš„åŒ…ï¼Œè€Œä¸æ˜¯ä» npm registry å®‰è£…
- pnpm ä¼šè‡ªåŠ¨å°† `workspace:*` è§£æä¸ºæœ¬åœ°åŒ…çš„è·¯å¾„
- å¦‚æœæœ¬åœ°åŒ…ä¸å­˜åœ¨ï¼Œå®‰è£…æ—¶ä¼šæŠ¥é”™

**é”™è¯¯ç¤ºä¾‹ï¼š**
```json
{
  "dependencies": {
    "@repo/ui": "latest"  // âŒ é”™è¯¯ï¼šä¼šå°è¯•ä» npm å®‰è£…
  }
}
```

### 2. åŒ…å‘½åè§„èŒƒ

**ä½¿ç”¨ä½œç”¨åŸŸåŒ…åï¼ˆScoped Packagesï¼‰ï¼š**
- `@repo/ui`ï¼šUI ç»„ä»¶åº“
- `@repo/utils`ï¼šå·¥å…·å‡½æ•°åº“

**å¥½å¤„ï¼š**
- é¿å…å‘½åå†²çª
- æ¸…æ™°çš„å‘½åç©ºé—´
- ç¬¦åˆ npm æœ€ä½³å®è·µ
- ä¾¿äºç®¡ç†å’Œè¯†åˆ«

---

## ä¸‰ã€è„šæœ¬ç®¡ç†ç­–ç•¥

### 1. æ ¹ç›®å½•è„šæœ¬ï¼ˆ`package.json`ï¼‰

#### è¿‡æ»¤å‘½ä»¤ï¼ˆFilterï¼‰

```json
{
  "scripts": {
    "dev:business": "pnpm --filter business dev",
    "dev:docs": "pnpm --filter docs dev",
    "dev:ui": "pnpm --filter @repo/ui dev"
  }
}
```

**è¯´æ˜ï¼š**
- `pnpm --filter <åŒ…å>`ï¼šåªå¯¹æŒ‡å®šåŒ…æ‰§è¡Œå‘½ä»¤
- å¯ä»¥ä½¿ç”¨åŒ…åï¼ˆå¦‚ `business`ï¼‰æˆ–å®Œæ•´åç§°ï¼ˆå¦‚ `@repo/ui`ï¼‰
- æ”¯æŒ glob æ¨¡å¼ï¼š`pnpm --filter './packages/*'`

#### é€’å½’å‘½ä»¤ï¼ˆRecursiveï¼‰

```json
{
  "scripts": {
    "dev:all": "pnpm run dev & pnpm -r --parallel dev",
    "lint": "pnpm -r lint",
    "clean": "pnpm -r clean"
  }
}
```

**å‘½ä»¤å‚æ•°è¯´æ˜ï¼š**
- `pnpm -r`ï¼šé€’å½’æ‰§è¡Œï¼Œåœ¨æ‰€æœ‰ workspace ä¸­æ‰§è¡Œ
- `pnpm --parallel`ï¼šå¹¶è¡Œæ‰§è¡Œå¤šä¸ªå‘½ä»¤
- `pnpm -r --parallel`ï¼šé€’å½’ä¸”å¹¶è¡Œæ‰§è¡Œ

#### æ„å»ºé¡ºåºæ§åˆ¶

```json
{
  "build": "pnpm --filter './packages/*' build && pnpm --filter './apps/*' build && next build"
}
```

**æ„å»ºé¡ºåºï¼š**
1. å…ˆæ„å»ºæ‰€æœ‰ packagesï¼ˆä¾èµ–åŒ…ï¼‰
2. å†æ„å»ºæ‰€æœ‰ appsï¼ˆåº”ç”¨ï¼‰
3. æœ€åæ„å»ºæ ¹åº”ç”¨

**åŸå› ï¼š** åº”ç”¨ä¾èµ– packagesï¼Œå¿…é¡»å…ˆæ„å»º packages æ‰èƒ½æ„å»ºåº”ç”¨ã€‚

---

## å››ã€Next.js é›†æˆé…ç½®

### 1. Transpile Packages

**åœ¨ `next.config.mjs` ä¸­é…ç½®ï¼š**

```javascript
const nextConfig = {
  transpilePackages: ['@repo/ui', '@repo/utils'],
}
```

**ä½œç”¨ï¼š**
- å‘Šè¯‰ Next.js éœ€è¦è½¬è¯‘è¿™äº›æœ¬åœ°åŒ…
- å› ä¸ºæœ¬åœ°åŒ…æ˜¯ TypeScript/ESM æ ¼å¼ï¼Œéœ€è¦è¢« Next.js å¤„ç†
- ç¡®ä¿æœ¬åœ°åŒ…èƒ½åœ¨ Next.js ä¸­æ­£å¸¸å·¥ä½œ

**ä¸ºä»€ä¹ˆéœ€è¦ï¼š**
- Next.js é»˜è®¤åªè½¬è¯‘ `node_modules` ä¸­çš„æŸäº›åŒ…
- æœ¬åœ° workspace åŒ…ä¸åœ¨æ ‡å‡†çš„ `node_modules` ä½ç½®
- éœ€è¦æ˜ç¡®å‘Šè¯‰ Next.js è½¬è¯‘è¿™äº›åŒ…

### 2. æ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½®

**æ¯ä¸ªåº”ç”¨éƒ½æœ‰è‡ªå·±çš„ï¼š**
- `next.config.mjs` - Next.js é…ç½®
- `postcss.config.mjs` - PostCSS é…ç½®
- `tsconfig.json` - TypeScript é…ç½®
- `package.json` - ä¾èµ–å’Œè„šæœ¬

**åŸå› ï¼š**
- åº”ç”¨å¯èƒ½æœ‰ä¸åŒçš„é…ç½®éœ€æ±‚
- é¿å…é…ç½®å†²çª
- æ›´å¥½çš„éš”ç¦»æ€§
- ä¾¿äºç‹¬ç«‹éƒ¨ç½²å’Œç»´æŠ¤

---

## äº”ã€TypeScript é…ç½®ç­–ç•¥

### 1. æ ¹é…ç½®ï¼ˆ`tsconfig.json`ï¼‰

**åŸºç¡€é…ç½®ï¼š**

```json
{
  "compilerOptions": {
    "moduleResolution": "bundler",
    "noEmit": true,
    "jsx": "preserve",
    // ... å…¶ä»–é…ç½®
  }
}
```

**ç‰¹ç‚¹ï¼š**
- é€‚ç”¨äº Next.js åº”ç”¨
- `noEmit: true` - ä¸ç”Ÿæˆæ–‡ä»¶ï¼Œç”± Next.js å¤„ç†
- `moduleResolution: "bundler"` - ä½¿ç”¨ bundler è§£ææ–¹å¼

### 2. å­åŒ…é…ç½®ï¼ˆç»§æ‰¿ + è¦†ç›–ï¼‰

**`packages/ui/tsconfig.json`ï¼š**

```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "noEmit": false,              // è¦†ç›–ï¼šéœ€è¦ç”Ÿæˆ .d.ts
    "moduleResolution": "node",   // è¦†ç›–ï¼šåº“æ„å»ºä½¿ç”¨ node
    "outDir": "./dist",
    "declaration": true,
    "declarationMap": true
  }
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨ `extends` ç»§æ‰¿æ ¹é…ç½®
- è¦†ç›–å¿…è¦çš„é€‰é¡¹ï¼ˆå¦‚ `noEmit`ï¼‰
- åº“åŒ…éœ€è¦ç”Ÿæˆç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆ`.d.ts`ï¼‰
- åº“æ„å»ºä½¿ç”¨ `moduleResolution: "node"` è€Œä¸æ˜¯ `"bundler"`

**ä¸ºä»€ä¹ˆéœ€è¦è¦†ç›–ï¼š**
- åº”ç”¨ï¼šä¸éœ€è¦ç”Ÿæˆæ–‡ä»¶ï¼Œç”±æ„å»ºå·¥å…·å¤„ç†
- åº“åŒ…ï¼šéœ€è¦ç”Ÿæˆ `.d.ts` æ–‡ä»¶ä¾›å…¶ä»–åŒ…ä½¿ç”¨

---

## å…­ã€åŒ…æ„å»ºé…ç½®

### 1. æ„å»ºå·¥å…·ï¼šTSUP

**`packages/ui/package.json`ï¼š**

```json
{
  "scripts": {
    "build": "tsup src/index.ts --format cjs,esm --dts --external react",
    "dev": "tsup src/index.ts --format cjs,esm --dts --external react --watch"
  }
}
```

**é…ç½®è¯´æ˜ï¼š**
- `--format cjs,esm`ï¼šåŒæ—¶ç”Ÿæˆ CommonJS å’Œ ESM æ ¼å¼
- `--dts`ï¼šç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆ`.d.ts`ï¼‰
- `--external react`ï¼šå°† react æ ‡è®°ä¸ºå¤–éƒ¨ä¾èµ–ï¼Œä¸æ‰“åŒ…è¿›åº“ä¸­
- `--watch`ï¼šå¼€å‘æ¨¡å¼ï¼Œç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡æ–°æ„å»º

**ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ ¼å¼ï¼š**
- CommonJSï¼šå…¼å®¹æ€§æ›´å¥½ï¼Œæ”¯æŒ `require()`
- ESMï¼šç°ä»£æ ‡å‡†ï¼Œæ”¯æŒ `import`
- è®©åŒ…å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨

### 2. åŒ…å¯¼å‡ºé…ç½®

**`packages/ui/package.json`ï¼š**

```json
{
  "main": "./dist/index.js",        // CommonJS å…¥å£
  "module": "./dist/index.mjs",     // ESM å…¥å£
  "types": "./dist/index.d.ts",     // ç±»å‹å®šä¹‰å…¥å£
  "exports": {
    ".": {
      "import": "./dist/index.mjs",
      "require": "./dist/index.js",
      "types": "./dist/index.d.ts"
    },
    "./styles.css": "./dist/index.css"
  }
}
```

**ä½œç”¨ï¼š**
- `main`ï¼šCommonJS å…¥å£ï¼ˆå‘åå…¼å®¹ï¼‰
- `module`ï¼šESM å…¥å£ï¼ˆç°ä»£æ ‡å‡†ï¼‰
- `types`ï¼šTypeScript ç±»å‹å®šä¹‰å…¥å£
- `exports`ï¼šæ›´ç²¾ç¡®çš„å¯¼å‡ºæ§åˆ¶ï¼Œæ”¯æŒæ¡ä»¶å¯¼å‡º

**`exports` å­—æ®µçš„ä¼˜åŠ¿ï¼š**
- æ”¯æŒæ¡ä»¶å¯¼å‡ºï¼ˆæ ¹æ®å¯¼å…¥æ–¹å¼é€‰æ‹©ä¸åŒæ–‡ä»¶ï¼‰
- æ›´å®‰å…¨ï¼ˆåªæš´éœ²æŒ‡å®šçš„è·¯å¾„ï¼‰
- æ”¯æŒå­è·¯å¾„å¯¼å‡ºï¼ˆå¦‚ `./styles.css`ï¼‰

### 3. Peer Dependencies

**`packages/ui/package.json`ï¼š**

```json
{
  "peerDependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0"
  }
}
```

**ä½œç”¨ï¼š**
- å£°æ˜è¿è¡Œæ—¶ä¾èµ–ï¼Œä½†ä¸ç›´æ¥å®‰è£…
- ç”±ä½¿ç”¨è¯¥åŒ…çš„åº”ç”¨æä¾›è¿™äº›ä¾èµ–
- é¿å…é‡å¤å®‰è£…ï¼Œå‡å°‘åŒ…ä½“ç§¯
- ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´æ€§

**ä¸ºä»€ä¹ˆä½¿ç”¨ peerDependenciesï¼š**
- React ç»„ä»¶åº“éœ€è¦ Reactï¼Œä½†ä¸åº”æ‰“åŒ… React
- è®©ä½¿ç”¨æ–¹å†³å®š React ç‰ˆæœ¬
- é¿å…å¤šä¸ª React å®ä¾‹å¯¼è‡´çš„é”™è¯¯

---

## ä¸ƒã€ä¾èµ–ç®¡ç†ç­–ç•¥

### 1. ä¾èµ–åˆ†å±‚

#### æ ¹ç›®å½• `package.json`
- å­˜æ”¾æ‰€æœ‰åº”ç”¨å…±äº«çš„ä¾èµ–
- å¦‚ï¼š`next`ã€`react`ã€`react-dom`ã€`tailwindcss` ç­‰
- è¿™äº›ä¾èµ–ä¼šè¢«æ‰€æœ‰åº”ç”¨å…±äº«

#### åº”ç”¨ `package.json`ï¼ˆå¦‚ `apps/business/package.json`ï¼‰
- å­˜æ”¾åº”ç”¨ç‰¹å®šçš„ä¾èµ–
- å¼•ç”¨æœ¬åœ°åŒ…ï¼š`@repo/ui`ã€`@repo/utils`
- åº”ç”¨ç‰¹å®šçš„å·¥å…·ï¼š`@tailwindcss/postcss`ã€`postcss`

#### åŒ… `package.json`ï¼ˆå¦‚ `packages/ui/package.json`ï¼‰
- åªåŒ…å«æ„å»ºå·¥å…·ä¾èµ–
- å¦‚ï¼š`tsup`ã€`typescript`
- ä½¿ç”¨ `peerDependencies` å£°æ˜è¿è¡Œæ—¶ä¾èµ–

### 2. ä¾èµ–å…±äº«æœºåˆ¶

**PNPM çš„ hoistingï¼š**
- ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–ä¼šè¢«æå‡åˆ°æ ¹ `node_modules`
- å‡å°‘ç£ç›˜å ç”¨
- åŠ å¿«å®‰è£…é€Ÿåº¦
- é¿å…é‡å¤å®‰è£…

**ç¤ºä¾‹ï¼š**
```
æ ¹ node_modules/
  â””â”€â”€ react/          # æ‰€æœ‰åº”ç”¨å…±äº«
  â””â”€â”€ next/           # æ‰€æœ‰åº”ç”¨å…±äº«

apps/business/node_modules/
  â””â”€â”€ .pnpm/          # ç¬¦å·é“¾æ¥åˆ°æ ¹ node_modules
```

---

## å…«ã€å¼€å‘å·¥ä½œæµ

### 1. å¼€å‘æ¨¡å¼

#### å•ç‹¬å¼€å‘

```bash
# åªå¯åŠ¨ business åº”ç”¨
pnpm dev:business

# åªå¯åŠ¨ UI åŒ…çš„ watch æ¨¡å¼
pnpm dev:ui
```

**é€‚ç”¨åœºæ™¯ï¼š**
- åªå¼€å‘æŸä¸ªç‰¹å®šåº”ç”¨
- ä¸éœ€è¦å…¶ä»–æœåŠ¡è¿è¡Œ
- èŠ‚çœèµ„æº

#### å¹¶è¡Œå¼€å‘

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬æ ¹åº”ç”¨ï¼‰
pnpm dev:all
```

**ä¼šå¯åŠ¨ï¼š**
- æ ¹åº”ç”¨ï¼š`http://localhost:3002/`
- Business åº”ç”¨ï¼š`http://localhost:3000/`
- Docs åº”ç”¨ï¼š`http://localhost:3001/`
- @repo/ui åŒ…ï¼šwatch æ¨¡å¼
- @repo/utils åŒ…ï¼šwatch æ¨¡å¼

**é€‚ç”¨åœºæ™¯ï¼š**
- å…¨æ ˆå¼€å‘
- éœ€è¦æµ‹è¯•åº”ç”¨é—´çš„é›†æˆ
- éœ€è¦åŒæ—¶æŸ¥çœ‹å¤šä¸ªåº”ç”¨

### 2. Watch æ¨¡å¼

**åŒ…å¼€å‘æ—¶ä½¿ç”¨ watchï¼š**

```json
{
  "dev": "tsup src/index.ts --format cjs,esm --dts --external react --watch"
}
```

**å¥½å¤„ï¼š**
- ä¿®æ”¹åŒ…ä»£ç åè‡ªåŠ¨é‡æ–°æ„å»º
- ä½¿ç”¨è¯¥åŒ…çš„åº”ç”¨å¯ä»¥ç«‹å³ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
- æé«˜å¼€å‘æ•ˆç‡
- æ— éœ€æ‰‹åŠ¨é‡æ–°æ„å»º

**å·¥ä½œæµç¨‹ï¼š**
1. å¯åŠ¨ `pnpm dev:ui`ï¼ˆUI åŒ… watch æ¨¡å¼ï¼‰
2. å¯åŠ¨ `pnpm dev:business`ï¼ˆä½¿ç”¨ UI åŒ…çš„åº”ç”¨ï¼‰
3. ä¿®æ”¹ UI åŒ…ä»£ç 
4. UI åŒ…è‡ªåŠ¨é‡æ–°æ„å»º
5. Business åº”ç”¨è‡ªåŠ¨çƒ­æ›´æ–°

---

## ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. é—®é¢˜ï¼šæ‰¾ä¸åˆ°æœ¬åœ°åŒ…

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ERR_PNPM_FETCH_404  GET https://registry.npmjs.org/@repo%2Fui: Not Found - 404
@repo/ui is not in the npm registry, or you have no permission to fetch it.
```

**åŸå› ï¼š**
- ä½¿ç”¨äº† `latest` è€Œä¸æ˜¯ `workspace:*`
- pnpm å°è¯•ä» npm registry è·å–åŒ…ï¼Œä½†æœ¬åœ°åŒ…ä¸å­˜åœ¨äº registry

**è§£å†³æ–¹æ¡ˆï¼š**
```json
{
  "dependencies": {
    "@repo/ui": "workspace:*"  // âœ… æ­£ç¡®
    // "@repo/ui": "latest"    // âŒ é”™è¯¯
  }
}
```

### 2. é—®é¢˜ï¼šNext.js æ— æ³•è¯†åˆ«æœ¬åœ°åŒ…

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Module not found: Can't resolve '@repo/ui'
```

**åŸå› ï¼š**
- Next.js æ²¡æœ‰é…ç½®è½¬è¯‘æœ¬åœ°åŒ…
- åŒ…æœªæ„å»º

**è§£å†³æ–¹æ¡ˆï¼š**

1. åœ¨ `next.config.mjs` ä¸­æ·»åŠ ï¼š
```javascript
const nextConfig = {
  transpilePackages: ['@repo/ui', '@repo/utils'],
}
```

2. ç¡®ä¿åŒ…å·²æ„å»ºï¼š
```bash
pnpm build:ui
pnpm build:utils
```

### 3. é—®é¢˜ï¼šTypeScript ç±»å‹é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Cannot find module '@repo/ui' or its type definitions.
```

**åŸå› ï¼š**
- åŒ…çš„ TypeScript é…ç½®ä¸æ­£ç¡®
- æœªç”Ÿæˆç±»å‹å®šä¹‰æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆï¼š**

1. ç¡®ä¿åŒ…çš„ `tsconfig.json` æ­£ç¡®é…ç½®ï¼š
```json
{
  "compilerOptions": {
    "noEmit": false,
    "declaration": true,
    "declarationMap": true
  }
}
```

2. ç¡®ä¿åŒ…å·²æ„å»ºå¹¶ç”Ÿæˆäº† `.d.ts` æ–‡ä»¶ï¼š
```bash
pnpm build:ui
# æ£€æŸ¥ packages/ui/dist/index.d.ts æ˜¯å¦å­˜åœ¨
```

### 4. é—®é¢˜ï¼šPostCSS é…ç½®æ‰¾ä¸åˆ°

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: Cannot find module '@tailwindcss/postcss'
```

**åŸå› ï¼š**
- åº”ç”¨ç›®å½•ç¼ºå°‘ PostCSS ç›¸å…³ä¾èµ–
- æ²¡æœ‰ `postcss.config.mjs` æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆï¼š**

1. åœ¨åº”ç”¨çš„ `package.json` ä¸­æ·»åŠ ä¾èµ–ï¼š
```json
{
  "devDependencies": {
    "@tailwindcss/postcss": "^4.0.0",
    "postcss": "^8.5",
    "tailwindcss": "^4.1.9"
  }
}
```

2. åœ¨åº”ç”¨ç›®å½•åˆ›å»º `postcss.config.mjs`ï¼š
```javascript
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}
export default config
```

### 5. é—®é¢˜ï¼šæ„å»ºé¡ºåºé”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Cannot find module '@repo/ui'
```

**åŸå› ï¼š**
- åœ¨æ„å»ºåº”ç”¨æ—¶ï¼Œä¾èµ–çš„åŒ…è¿˜æœªæ„å»º

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿æ„å»ºé¡ºåºï¼špackages â†’ apps â†’ root
- ä½¿ç”¨æ­£ç¡®çš„æ„å»ºå‘½ä»¤ï¼š
```bash
pnpm build  # ä¼šè‡ªåŠ¨æŒ‰é¡ºåºæ„å»º
```

---

## åã€æœ€ä½³å®è·µæ€»ç»“

### 1. åŒ…å‘½å
- âœ… ä½¿ç”¨ä½œç”¨åŸŸåŒ…åï¼ˆ`@repo/*`ï¼‰
- âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
- âŒ é¿å…ä½¿ç”¨é€šç”¨åç§°

### 2. æœ¬åœ°åŒ…å¼•ç”¨
- âœ… ä½¿ç”¨ `workspace:*` åè®®
- âŒ ä¸è¦ä½¿ç”¨ `latest` æˆ–å…·ä½“ç‰ˆæœ¬å·

### 3. æ„å»ºé¡ºåº
- âœ… å…ˆæ„å»º packagesï¼Œå†æ„å»º apps
- âœ… ä½¿ç”¨ `&&` ç¡®ä¿é¡ºåºæ‰§è¡Œ
- âŒ ä¸è¦å¹¶è¡Œæ„å»ºæœ‰ä¾èµ–å…³ç³»çš„åŒ…

### 4. Next.js é…ç½®
- âœ… åœ¨ `transpilePackages` ä¸­å£°æ˜æ‰€æœ‰æœ¬åœ°åŒ…
- âœ… æ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½®
- âŒ ä¸è¦å…±äº« `next.config.mjs`

### 5. TypeScript é…ç½®
- âœ… ä½¿ç”¨ç»§æ‰¿ + è¦†ç›–çš„æ–¹å¼
- âœ… åº“åŒ…éœ€è¦ `noEmit: false` å’Œ `declaration: true`
- âŒ ä¸è¦å®Œå…¨å¤åˆ¶æ ¹é…ç½®

### 6. ä¾èµ–ç®¡ç†
- âœ… å…±äº«ä¾èµ–æ”¾åœ¨æ ¹ç›®å½•
- âœ… ä½¿ç”¨ `peerDependencies` å£°æ˜è¿è¡Œæ—¶ä¾èµ–
- âœ… åº”ç”¨ç‰¹å®šä¾èµ–æ”¾åœ¨åº”ç”¨ç›®å½•
- âŒ é¿å…é‡å¤å®‰è£…ç›¸åŒä¾èµ–

### 7. è„šæœ¬ç®¡ç†
- âœ… ä½¿ç”¨ `pnpm --filter` ç²¾ç¡®æ§åˆ¶
- âœ… ä½¿ç”¨ `pnpm -r` æ‰¹é‡æ‰§è¡Œ
- âœ… ä½¿ç”¨ `--parallel` æé«˜æ•ˆç‡
- âŒ é¿å…æ‰‹åŠ¨è¿›å…¥æ¯ä¸ªç›®å½•æ‰§è¡Œå‘½ä»¤

### 8. å¼€å‘æµç¨‹
- âœ… ä½¿ç”¨ watch æ¨¡å¼å¼€å‘åŒ…
- âœ… å¹¶è¡Œå¯åŠ¨éœ€è¦çš„æœåŠ¡
- âœ… ä¿æŒæ„å»ºé¡ºåºæ­£ç¡®
- âŒ é¿å…æ‰‹åŠ¨é‡æ–°æ„å»º

### 9. é…ç½®éš”ç¦»
- âœ… æ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½®
- âœ… é¿å…é…ç½®å†²çª
- âŒ ä¸è¦å…±äº«é…ç½®æ–‡ä»¶

### 10. ç›®å½•ç»“æ„
- âœ… æ¸…æ™°çš„ apps/ å’Œ packages/ åˆ†ç¦»
- âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„ç›®å½•å
- âŒ é¿å…æ·±å±‚åµŒå¥—

---

## åä¸€ã€å‘½ä»¤é€ŸæŸ¥è¡¨

### å®‰è£…ä¸ä¾èµ–

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm install` | å®‰è£…æ‰€æœ‰ä¾èµ– |
| `pnpm add <åŒ…å> -w` | åœ¨æ ¹ç›®å½•æ·»åŠ ä¾èµ– |
| `pnpm add <åŒ…å> --filter <åŒ…å>` | åœ¨æŒ‡å®šåŒ…ä¸­æ·»åŠ ä¾èµ– |

### å¼€å‘å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | ç«¯å£ |
|------|------|------|
| `pnpm dev` | å¯åŠ¨æ ¹åº”ç”¨ | 3002 |
| `pnpm dev:all` | å¯åŠ¨æ‰€æœ‰æœåŠ¡ | - |
| `pnpm dev:business` | å¯åŠ¨ business åº”ç”¨ | 3000 |
| `pnpm dev:docs` | å¯åŠ¨ docs åº”ç”¨ | 3001 |
| `pnpm dev:ui` | UI åŒ… watch æ¨¡å¼ | - |
| `pnpm dev:utils` | Utils åŒ… watch æ¨¡å¼ | - |

### æ„å»ºå‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm build` | æ„å»ºæ‰€æœ‰åŒ…å’Œåº”ç”¨ |
| `pnpm build:business` | åªæ„å»º business åº”ç”¨ |
| `pnpm build:docs` | åªæ„å»º docs åº”ç”¨ |
| `pnpm build:ui` | åªæ„å»º UI åŒ… |
| `pnpm build:utils` | åªæ„å»º Utils åŒ… |

### å·¥å…·å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `pnpm -r lint` | æ‰€æœ‰åŒ…æ‰§è¡Œ lint |
| `pnpm -r clean` | æ¸…ç†æ‰€æœ‰åŒ…çš„æ„å»ºäº§ç‰© |
| `pnpm --filter <åŒ…å> <å‘½ä»¤>` | å¯¹æŒ‡å®šåŒ…æ‰§è¡Œå‘½ä»¤ |
| `pnpm -r --parallel <å‘½ä»¤>` | å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰åŒ…çš„å‘½ä»¤ |

### å¸¸ç”¨ç»„åˆ

```bash
# å¼€å‘ UI åŒ… + Business åº”ç”¨
pnpm dev:ui & pnpm dev:business

# æ„å»ºæ‰€æœ‰åŒ…
pnpm build:ui && pnpm build:utils && pnpm build

# æ¸…ç†å¹¶é‡æ–°æ„å»º
pnpm -r clean && pnpm build
```

---

## ğŸ“ æ€»ç»“

æœ¬ monorepo é¡¹ç›®ä½¿ç”¨ **PNPM Workspace** ä½œä¸ºåŒ…ç®¡ç†å·¥å…·ï¼Œé€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæœºåˆ¶å®ç°å¤šåŒ…ç®¡ç†ï¼š

1. **Workspace åè®®**ï¼šä½¿ç”¨ `workspace:*` å¼•ç”¨æœ¬åœ°åŒ…
2. **è„šæœ¬è¿‡æ»¤**ï¼šä½¿ç”¨ `--filter` ç²¾ç¡®æ§åˆ¶æ‰§è¡ŒèŒƒå›´
3. **æ„å»ºé¡ºåº**ï¼šç¡®ä¿ä¾èµ–å…³ç³»æ­£ç¡®çš„æ„å»ºé¡ºåº
4. **é…ç½®éš”ç¦»**ï¼šæ¯ä¸ªåº”ç”¨ç‹¬ç«‹é…ç½®ï¼Œé¿å…å†²çª
5. **ç±»å‹æ”¯æŒ**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
6. **å¼€å‘æ•ˆç‡**ï¼šWatch æ¨¡å¼æé«˜å¼€å‘ä½“éªŒ

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥é«˜æ•ˆåœ°ç®¡ç†å’Œå¼€å‘ monorepo é¡¹ç›®ã€‚

---

**æœ€åæ›´æ–°ï¼š** 2024å¹´

